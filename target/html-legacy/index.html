<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Legacy Enterprise Portal - QA Test Target</title>
  <style>
    :root {
      --primary: #1a365d;
      --secondary: #2b6cb0;
      --accent: #ed8936;
      --bg: #f7fafc;
      --surface: #ffffff;
      --text: #2d3748;
      --border: #e2e8f0;
      --success: #38a169;
      --error: #e53e3e;
      --shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
    }

    /* Legacy Header */
    .header {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: var(--shadow);
    }

    .logo { font-size: 1.5rem; font-weight: bold; }

    .nav-menu {
      display: flex;
      gap: 0.5rem;
    }

    .nav-item {
      padding: 0.5rem 1rem;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      color: white;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.2s;
    }

    .nav-item:hover {
      background: rgba(255,255,255,0.2);
    }

    /* Layout */
    .container {
      display: flex;
      min-height: calc(100vh - 60px);
    }

    .sidebar {
      width: 250px;
      background: var(--surface);
      border-right: 1px solid var(--border);
      padding: 1rem;
    }

    .sidebar-item {
      display: block;
      padding: 0.75rem 1rem;
      margin: 0.25rem 0;
      background: none;
      border: none;
      width: 100%;
      text-align: left;
      cursor: pointer;
      border-radius: 4px;
      color: var(--text);
      font-size: 0.95rem;
      transition: all 0.2s;
    }

    .sidebar-item:hover, .sidebar-item.active {
      background: var(--secondary);
      color: white;
    }

    .main-content {
      flex: 1;
      padding: 2rem;
      overflow-y: auto;
    }

    .section {
      background: var(--surface);
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      box-shadow: var(--shadow);
    }

    .section-title {
      font-size: 1.25rem;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid var(--secondary);
      color: var(--primary);
    }

    /* Buttons */
    .btn {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.2s;
    }

    .btn-primary {
      background: var(--secondary);
      color: white;
    }

    .btn-primary:hover { background: var(--primary); }

    .btn-danger {
      background: var(--error);
      color: white;
    }

    .btn-danger:hover { opacity: 0.9; }

    .btn-outline {
      background: transparent;
      border: 1px solid var(--secondary);
      color: var(--secondary);
    }

    .btn-outline:hover {
      background: var(--secondary);
      color: white;
    }

    /* Forms */
    .form-group {
      margin-bottom: 1rem;
    }

    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    .form-input {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--border);
      border-radius: 4px;
      font-size: 1rem;
      transition: border-color 0.2s;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--secondary);
      box-shadow: 0 0 0 3px rgba(43, 108, 176, 0.1);
    }

    .form-input.error {
      border-color: var(--error);
    }

    .form-error {
      color: var(--error);
      font-size: 0.85rem;
      margin-top: 0.25rem;
    }

    /* Tabs */
    .tabs {
      display: flex;
      border-bottom: 2px solid var(--border);
      margin-bottom: 1rem;
    }

    .tab {
      padding: 0.75rem 1.5rem;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1rem;
      color: var(--text);
      border-bottom: 2px solid transparent;
      margin-bottom: -2px;
      transition: all 0.2s;
    }

    .tab:hover { color: var(--secondary); }

    .tab.active {
      color: var(--secondary);
      border-bottom-color: var(--secondary);
    }

    .tab-content {
      display: none;
      animation: fadeIn 0.3s;
    }

    .tab-content.active { display: block; }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-overlay.open { display: flex; }

    .modal {
      background: var(--surface);
      border-radius: 8px;
      width: 100%;
      max-width: 500px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      animation: slideIn 0.3s;
    }

    @keyframes slideIn {
      from { transform: translateY(-20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .modal-header {
      padding: 1rem 1.5rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title { font-size: 1.25rem; font-weight: 600; }

    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #666;
    }

    .modal-body { padding: 1.5rem; }

    .modal-footer {
      padding: 1rem 1.5rem;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
    }

    /* Iframe Container */
    .iframe-container {
      border: 2px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
      background: white;
    }

    .iframe-toolbar {
      display: flex;
      gap: 0.5rem;
      padding: 0.5rem;
      background: var(--bg);
      border-bottom: 1px solid var(--border);
    }

    .iframe-url {
      flex: 1;
      padding: 0.5rem;
      border: 1px solid var(--border);
      border-radius: 4px;
      font-size: 0.9rem;
    }

    iframe {
      width: 100%;
      height: 300px;
      border: none;
    }

    /* Canvas */
    .canvas-container {
      border: 2px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
    }

    .canvas-toolbar {
      display: flex;
      gap: 0.5rem;
      padding: 0.5rem;
      background: var(--bg);
      border-bottom: 1px solid var(--border);
      flex-wrap: wrap;
    }

    .color-picker {
      width: 40px;
      height: 40px;
      border: 1px solid var(--border);
      border-radius: 4px;
      cursor: pointer;
    }

    canvas {
      display: block;
      background: white;
      cursor: crosshair;
    }

    /* Accordion */
    .accordion-item {
      border: 1px solid var(--border);
      border-radius: 4px;
      margin-bottom: 0.5rem;
      overflow: hidden;
    }

    .accordion-header {
      width: 100%;
      padding: 1rem;
      background: var(--bg);
      border: none;
      text-align: left;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 1rem;
      font-weight: 500;
    }

    .accordion-header:hover { background: #edf2f7; }

    .accordion-icon {
      transition: transform 0.3s;
    }

    .accordion-item.open .accordion-icon {
      transform: rotate(180deg);
    }

    .accordion-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s;
    }

    .accordion-item.open .accordion-content {
      max-height: 500px;
    }

    .accordion-body {
      padding: 1rem;
      border-top: 1px solid var(--border);
    }

    /* Data Table */
    .data-table {
      width: 100%;
      border-collapse: collapse;
    }

    .data-table th, .data-table td {
      padding: 0.75rem;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }

    .data-table th {
      background: var(--bg);
      font-weight: 600;
      cursor: pointer;
      user-select: none;
    }

    .data-table th:hover { background: #edf2f7; }

    .data-table tr:hover { background: #f8fafc; }

    .table-actions {
      display: flex;
      gap: 0.25rem;
    }

    .action-btn {
      padding: 0.25rem 0.5rem;
      font-size: 0.8rem;
      cursor: pointer;
      border-radius: 4px;
    }

    /* Dropdown */
    .dropdown {
      position: relative;
      display: inline-block;
    }

    .dropdown-menu {
      position: absolute;
      top: 100%;
      left: 0;
      min-width: 200px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 4px;
      box-shadow: var(--shadow);
      display: none;
      z-index: 100;
    }

    .dropdown.open .dropdown-menu { display: block; }

    .dropdown-item {
      display: block;
      padding: 0.75rem 1rem;
      cursor: pointer;
      border: none;
      background: none;
      width: 100%;
      text-align: left;
      font-size: 0.95rem;
    }

    .dropdown-item:hover { background: var(--bg); }

    /* Progress Bar */
    .progress-bar {
      height: 20px;
      background: var(--border);
      border-radius: 10px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--secondary), var(--accent));
      transition: width 0.5s ease;
    }

    /* Toast */
    .toast-container {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      z-index: 2000;
    }

    .toast {
      background: var(--surface);
      padding: 1rem 1.5rem;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      margin-top: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      animation: slideInRight 0.3s;
    }

    @keyframes slideInRight {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    .toast.success { border-left: 4px solid var(--success); }
    .toast.error { border-left: 4px solid var(--error); }

    /* Grid Layout */
    .grid {
      display: grid;
      gap: 1rem;
    }

    .grid-2 { grid-template-columns: repeat(2, 1fr); }
    .grid-3 { grid-template-columns: repeat(3, 1fr); }

    /* Status Badge */
    .status-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .status-active { background: #c6f6d5; color: #276749; }
    .status-pending { background: #feebc8; color: #c05621; }
    .status-inactive { background: #fed7d7; color: #c53030; }

    /* Checkbox/Radio Custom */
    .custom-checkbox {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      cursor: pointer;
    }

    .custom-checkbox input { display: none; }

    .checkbox-mark {
      width: 20px;
      height: 20px;
      border: 2px solid var(--border);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .custom-checkbox input:checked + .checkbox-mark {
      background: var(--secondary);
      border-color: var(--secondary);
      color: white;
    }

    /* File Upload */
    .file-upload {
      border: 2px dashed var(--border);
      border-radius: 8px;
      padding: 2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }

    .file-upload:hover {
      border-color: var(--secondary);
      background: #f7fafc;
    }

    .file-upload.dragover {
      border-color: var(--accent);
      background: #fffaf0;
    }

    /* Tooltip */
    .tooltip {
      position: relative;
    }

    .tooltip::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      padding: 0.5rem 0.75rem;
      background: #2d3748;
      color: white;
      font-size: 0.8rem;
      border-radius: 4px;
      white-space: nowrap;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s;
    }

    .tooltip:hover::after {
      opacity: 1;
      visibility: visible;
    }

    /* Legacy Popup Window Controls */
    .popup-triggers {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header" data-testid="header">
    <div class="logo" data-testid="logo">Enterprise Portal</div>
    <nav class="nav-menu" data-testid="nav-menu">
      <a href="#" class="nav-item" data-testid="nav-dashboard">Dashboard</a>
      <a href="#" class="nav-item" data-testid="nav-reports">Reports</a>
      <a href="#" class="nav-item" data-testid="nav-users">Users</a>
      <div class="dropdown" data-testid="nav-dropdown">
        <button class="nav-item" data-testid="nav-more" onclick="toggleDropdown(this.parentElement)">
          More ‚ñº
        </button>
        <div class="dropdown-menu">
          <button class="dropdown-item" data-testid="dropdown-settings">Settings</button>
          <button class="dropdown-item" data-testid="dropdown-help">Help Center</button>
          <button class="dropdown-item" data-testid="dropdown-about">About</button>
        </div>
      </div>
    </nav>
  </header>

  <div class="container">
    <!-- Sidebar -->
    <aside class="sidebar" data-testid="sidebar">
      <button class="sidebar-item active" data-testid="sidebar-overview" onclick="showSection('overview')">
        üìä Overview
      </button>
      <button class="sidebar-item" data-testid="sidebar-forms" onclick="showSection('forms')">
        üìù Forms Demo
      </button>
      <button class="sidebar-item" data-testid="sidebar-iframe" onclick="showSection('iframe')">
        üñºÔ∏è IFrame Content
      </button>
      <button class="sidebar-item" data-testid="sidebar-canvas" onclick="showSection('canvas')">
        üé® Canvas Drawing
      </button>
      <button class="sidebar-item" data-testid="sidebar-shadow" onclick="showSection('shadow')">
        üîÆ Shadow DOM
      </button>
      <button class="sidebar-item" data-testid="sidebar-popups" onclick="showSection('popups')">
        üí¨ Popups & Modals
      </button>
      <button class="sidebar-item" data-testid="sidebar-data" onclick="showSection('data')">
        üìã Data Tables
      </button>
    </aside>

    <!-- Main Content -->
    <main class="main-content" data-testid="main-content">
      <!-- Overview Section -->
      <div id="section-overview" class="section-wrapper active" data-testid="section-overview">
        <div class="section">
          <h2 class="section-title">Overview Dashboard</h2>
          <div class="grid grid-3" style="margin-bottom: 1.5rem;">
            <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 1.5rem; border-radius: 8px;">
              <div style="font-size: 2rem; font-weight: bold;" data-testid="stat-users">1,234</div>
              <div>Active Users</div>
            </div>
            <div style="background: linear-gradient(135deg, #f093fb, #f5576c); color: white; padding: 1.5rem; border-radius: 8px;">
              <div style="font-size: 2rem; font-weight: bold;" data-testid="stat-orders">567</div>
              <div>Orders Today</div>
            </div>
            <div style="background: linear-gradient(135deg, #4facfe, #00f2fe); color: white; padding: 1.5rem; border-radius: 8px;">
              <div style="font-size: 2rem; font-weight: bold;" data-testid="stat-revenue">$89,432</div>
              <div>Revenue</div>
            </div>
          </div>

          <!-- Progress Section -->
          <h3 style="margin-bottom: 1rem;">Monthly Progress</h3>
          <div style="margin-bottom: 1rem;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
              <span>Sales Target</span>
              <span data-testid="progress-sales">75%</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" style="width: 75%;" data-testid="progress-bar-sales"></div>
            </div>
          </div>
          <div style="margin-bottom: 1rem;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
              <span>Customer Acquisition</span>
              <span data-testid="progress-customers">60%</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" style="width: 60%;" data-testid="progress-bar-customers"></div>
            </div>
          </div>
        </div>

        <!-- Accordion Section -->
        <div class="section">
          <h2 class="section-title">FAQ (Accordion)</h2>
          <div class="accordion-item" data-testid="accordion-1">
            <button class="accordion-header" onclick="toggleAccordion(this.parentElement)">
              <span>How do I reset my password?</span>
              <span class="accordion-icon">‚ñº</span>
            </button>
            <div class="accordion-content">
              <div class="accordion-body">
                Click on the "Forgot Password" link on the login page. Enter your email address and follow the instructions sent to your inbox.
              </div>
            </div>
          </div>
          <div class="accordion-item" data-testid="accordion-2">
            <button class="accordion-header" onclick="toggleAccordion(this.parentElement)">
              <span>What payment methods do you accept?</span>
              <span class="accordion-icon">‚ñº</span>
            </button>
            <div class="accordion-content">
              <div class="accordion-body">
                We accept all major credit cards (Visa, MasterCard, American Express), PayPal, and bank transfers for enterprise accounts.
              </div>
            </div>
          </div>
          <div class="accordion-item" data-testid="accordion-3">
            <button class="accordion-header" onclick="toggleAccordion(this.parentElement)">
              <span>How can I contact support?</span>
              <span class="accordion-icon">‚ñº</span>
            </button>
            <div class="accordion-content">
              <div class="accordion-body">
                You can reach our support team via email at support@example.com or through our live chat available 24/7.
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Forms Section -->
      <div id="section-forms" class="section-wrapper" style="display: none;" data-testid="section-forms">
        <div class="section">
          <h2 class="section-title">Form Elements Demo</h2>

          <!-- Tabs -->
          <div class="tabs" data-testid="form-tabs">
            <button class="tab active" data-testid="tab-contact" onclick="showTab('contact')">Contact Form</button>
            <button class="tab" data-testid="tab-registration" onclick="showTab('registration')">Registration</button>
            <button class="tab" data-testid="tab-feedback" onclick="showTab('feedback')">Feedback</button>
          </div>

          <!-- Contact Form Tab -->
          <div id="tab-contact" class="tab-content active" data-testid="form-contact">
            <form id="contactForm" onsubmit="handleContactSubmit(event)">
              <div class="grid grid-2">
                <div class="form-group">
                  <label class="form-label">First Name *</label>
                  <input type="text" class="form-input" name="firstName" data-testid="input-firstname" required>
                  <span class="form-error" id="error-firstName"></span>
                </div>
                <div class="form-group">
                  <label class="form-label">Last Name *</label>
                  <input type="text" class="form-input" name="lastName" data-testid="input-lastname" required>
                  <span class="form-error" id="error-lastName"></span>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">Email *</label>
                <input type="email" class="form-input" name="email" data-testid="input-email" required>
                <span class="form-error" id="error-email"></span>
              </div>
              <div class="form-group">
                <label class="form-label">Phone</label>
                <input type="tel" class="form-input" name="phone" data-testid="input-phone" placeholder="+1 (555) 000-0000">
              </div>
              <div class="form-group">
                <label class="form-label">Subject</label>
                <select class="form-input" name="subject" data-testid="select-subject">
                  <option value="">Select a subject...</option>
                  <option value="general">General Inquiry</option>
                  <option value="support">Technical Support</option>
                  <option value="billing">Billing Question</option>
                  <option value="feedback">Feedback</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Message *</label>
                <textarea class="form-input" name="message" rows="4" data-testid="textarea-message" required></textarea>
                <span class="form-error" id="error-message"></span>
              </div>
              <div class="form-group">
                <label class="custom-checkbox" data-testid="checkbox-newsletter">
                  <input type="checkbox" name="newsletter">
                  <span class="checkbox-mark">‚úì</span>
                  <span>Subscribe to newsletter</span>
                </label>
              </div>
              <div class="form-group">
                <label class="custom-checkbox" data-testid="checkbox-terms">
                  <input type="checkbox" name="terms" required>
                  <span class="checkbox-mark">‚úì</span>
                  <span>I agree to the Terms and Conditions *</span>
                </label>
              </div>
              <button type="submit" class="btn btn-primary" data-testid="submit-contact">Send Message</button>
            </form>
          </div>

          <!-- Registration Tab -->
          <div id="tab-registration" class="tab-content" data-testid="form-registration">
            <form id="registrationForm" onsubmit="handleRegistrationSubmit(event)">
              <div class="form-group">
                <label class="form-label">Username *</label>
                <input type="text" class="form-input" name="username" data-testid="input-username" minlength="3" required>
              </div>
              <div class="grid grid-2">
                <div class="form-group">
                  <label class="form-label">Password *</label>
                  <input type="password" class="form-input" name="password" data-testid="input-password" minlength="8" required>
                </div>
                <div class="form-group">
                  <label class="form-label">Confirm Password *</label>
                  <input type="password" class="form-input" name="confirmPassword" data-testid="input-confirm-password" required>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">Account Type</label>
                <div style="display: flex; gap: 1rem;">
                  <label class="custom-checkbox" data-testid="radio-personal">
                    <input type="radio" name="accountType" value="personal" checked>
                    <span class="checkbox-mark">‚óè</span>
                    <span>Personal</span>
                  </label>
                  <label class="custom-checkbox" data-testid="radio-business">
                    <input type="radio" name="accountType" value="business">
                    <span class="checkbox-mark">‚óè</span>
                    <span>Business</span>
                  </label>
                  <label class="custom-checkbox" data-testid="radio-enterprise">
                    <input type="radio" name="accountType" value="enterprise">
                    <span class="checkbox-mark">‚óè</span>
                    <span>Enterprise</span>
                  </label>
                </div>
              </div>
              <button type="submit" class="btn btn-primary" data-testid="submit-registration">Create Account</button>
            </form>
          </div>

          <!-- Feedback Tab -->
          <div id="tab-feedback" class="tab-content" data-testid="form-feedback">
            <form id="feedbackForm" onsubmit="handleFeedbackSubmit(event)">
              <div class="form-group">
                <label class="form-label">Rating</label>
                <div style="display: flex; gap: 0.5rem;" data-testid="rating-stars">
                  <button type="button" class="btn btn-outline" onclick="setRating(1)" data-testid="star-1">‚≠ê</button>
                  <button type="button" class="btn btn-outline" onclick="setRating(2)" data-testid="star-2">‚≠ê</button>
                  <button type="button" class="btn btn-outline" onclick="setRating(3)" data-testid="star-3">‚≠ê</button>
                  <button type="button" class="btn btn-outline" onclick="setRating(4)" data-testid="star-4">‚≠ê</button>
                  <button type="button" class="btn btn-outline" onclick="setRating(5)" data-testid="star-5">‚≠ê</button>
                </div>
                <input type="hidden" name="rating" id="ratingValue" value="0">
              </div>
              <div class="form-group">
                <label class="form-label">Feedback</label>
                <textarea class="form-input" name="feedback" rows="4" data-testid="textarea-feedback"></textarea>
              </div>

              <!-- File Upload -->
              <div class="form-group">
                <label class="form-label">Attach Screenshot (optional)</label>
                <div class="file-upload" data-testid="file-upload" onclick="document.getElementById('fileInput').click()">
                  <input type="file" id="fileInput" style="display: none" accept="image/*" data-testid="file-input" onchange="handleFileSelect(this)">
                  <div style="font-size: 2rem;">üìÅ</div>
                  <p>Click to upload or drag and drop</p>
                  <p style="font-size: 0.85rem; color: #666;">PNG, JPG up to 5MB</p>
                </div>
                <div id="filePreview" style="margin-top: 0.5rem;" data-testid="file-preview"></div>
              </div>

              <button type="submit" class="btn btn-primary" data-testid="submit-feedback">Submit Feedback</button>
            </form>
          </div>
        </div>
      </div>

      <!-- IFrame Section -->
      <div id="section-iframe" class="section-wrapper" style="display: none;" data-testid="section-iframe">
        <div class="section">
          <h2 class="section-title">IFrame Content</h2>
          <p style="margin-bottom: 1rem;">Testing iframe embedding and communication:</p>

          <div class="iframe-container" data-testid="iframe-container-1">
            <div class="iframe-toolbar">
              <input type="text" class="iframe-url" value="about:blank" data-testid="iframe-url-1" readonly>
              <button class="btn btn-outline" data-testid="iframe-refresh-1" onclick="refreshIframe('iframe1')">üîÑ Refresh</button>
            </div>
            <iframe id="iframe1" src="about:blank" data-testid="iframe-1"></iframe>
          </div>

          <div style="margin-top: 1rem;">
            <button class="btn btn-primary" data-testid="iframe-load-form" onclick="loadIframeContent('form')">
              Load Form Content
            </button>
            <button class="btn btn-outline" data-testid="iframe-load-chart" onclick="loadIframeContent('chart')">
              Load Chart Content
            </button>
            <button class="btn btn-outline" data-testid="iframe-load-list" onclick="loadIframeContent('list')">
              Load List Content
            </button>
          </div>

          <!-- Nested IFrame -->
          <h3 style="margin: 2rem 0 1rem;">Nested IFrame</h3>
          <div class="iframe-container" data-testid="iframe-container-nested">
            <iframe id="iframeNested" srcdoc="<html><body style='padding:20px;font-family:sans-serif;'>
              <h3>Nested IFrame Level 1</h3>
              <p>This iframe contains another iframe:</p>
              <iframe style='width:100%;height:150px;border:1px solid #ccc;' srcdoc='<html><body style=\"padding:10px;font-family:sans-serif;\">
                <h4>Nested IFrame Level 2</h4>
                <button onclick=\"alert(\\\"Button clicked in nested iframe!\\\")\" data-testid=\"nested-btn\">Click Me</button>
                <input type=\"text\" placeholder=\"Type here...\" data-testid=\"nested-input\">
              </body></html>'></iframe>
            </body></html>" data-testid="iframe-nested" style="height: 250px;"></iframe>
          </div>
        </div>
      </div>

      <!-- Canvas Section -->
      <div id="section-canvas" class="section-wrapper" style="display: none;" data-testid="section-canvas">
        <div class="section">
          <h2 class="section-title">Canvas Drawing</h2>

          <div class="canvas-container" data-testid="canvas-container">
            <div class="canvas-toolbar">
              <input type="color" class="color-picker" id="brushColor" value="#1a365d" data-testid="brush-color">
              <select id="brushSize" class="form-input" style="width: auto;" data-testid="brush-size">
                <option value="2">Small</option>
                <option value="5" selected>Medium</option>
                <option value="10">Large</option>
                <option value="20">Extra Large</option>
              </select>
              <select id="brushType" class="form-input" style="width: auto;" data-testid="brush-type">
                <option value="round">Round</option>
                <option value="square">Square</option>
              </select>
              <button class="btn btn-outline" data-testid="canvas-undo" onclick="undoCanvas()">‚Ü©Ô∏è Undo</button>
              <button class="btn btn-danger" data-testid="canvas-clear" onclick="clearCanvas()">üóëÔ∏è Clear</button>
              <button class="btn btn-primary" data-testid="canvas-save" onclick="saveCanvas()">üíæ Save</button>
            </div>
            <canvas id="drawingCanvas" width="800" height="400" data-testid="drawing-canvas"></canvas>
          </div>

          <!-- Chart Canvas -->
          <h3 style="margin: 2rem 0 1rem;">Chart Canvas</h3>
          <div class="canvas-container">
            <div class="canvas-toolbar">
              <button class="btn btn-primary" data-testid="chart-bar" onclick="drawChart('bar')">Bar Chart</button>
              <button class="btn btn-outline" data-testid="chart-line" onclick="drawChart('line')">Line Chart</button>
              <button class="btn btn-outline" data-testid="chart-pie" onclick="drawChart('pie')">Pie Chart</button>
            </div>
            <canvas id="chartCanvas" width="800" height="300" data-testid="chart-canvas"></canvas>
          </div>
        </div>
      </div>

      <!-- Shadow DOM Section -->
      <div id="section-shadow" class="section-wrapper" style="display: none;" data-testid="section-shadow">
        <div class="section">
          <h2 class="section-title">Shadow DOM Components</h2>
          <p style="margin-bottom: 1rem;">These components use Shadow DOM for encapsulation:</p>

          <!-- Shadow DOM Components will be injected here -->
          <div id="shadow-card-container" data-testid="shadow-card-container"></div>

          <div style="margin-top: 2rem;">
            <h3>Custom Button Component (Shadow DOM)</h3>
            <div id="shadow-button-container" data-testid="shadow-button-container"></div>
          </div>

          <div style="margin-top: 2rem;">
            <h3>Custom Input Component (Shadow DOM)</h3>
            <div id="shadow-input-container" data-testid="shadow-input-container"></div>
          </div>

          <div style="margin-top: 2rem;">
            <h3>Custom Toggle Component (Shadow DOM)</h3>
            <div id="shadow-toggle-container" data-testid="shadow-toggle-container"></div>
          </div>
        </div>
      </div>

      <!-- Popups Section -->
      <div id="section-popups" class="section-wrapper" style="display: none;" data-testid="section-popups">
        <div class="section">
          <h2 class="section-title">Popups, Modals & Alerts</h2>

          <h3 style="margin-bottom: 1rem;">Modal Dialogs</h3>
          <div class="popup-triggers">
            <button class="btn btn-primary" data-testid="open-modal-basic" onclick="openModal('basic')">
              Open Basic Modal
            </button>
            <button class="btn btn-outline" data-testid="open-modal-form" onclick="openModal('form')">
              Open Form Modal
            </button>
            <button class="btn btn-outline" data-testid="open-modal-confirm" onclick="openModal('confirm')">
              Confirm Dialog
            </button>
          </div>

          <h3 style="margin: 2rem 0 1rem;">Browser Popups (New Window)</h3>
          <div class="popup-triggers">
            <button class="btn btn-primary" data-testid="popup-window" onclick="openPopupWindow()">
              Open Popup Window
            </button>
            <button class="btn btn-outline" data-testid="popup-print" onclick="window.print()">
              Print Dialog
            </button>
          </div>

          <h3 style="margin: 2rem 0 1rem;">Toast Notifications</h3>
          <div class="popup-triggers">
            <button class="btn btn-primary" data-testid="toast-success" onclick="showToast('success', 'Operation completed successfully!')">
              Success Toast
            </button>
            <button class="btn btn-danger" data-testid="toast-error" onclick="showToast('error', 'An error occurred!')">
              Error Toast
            </button>
          </div>

          <h3 style="margin: 2rem 0 1rem;">Native Alerts</h3>
          <div class="popup-triggers">
            <button class="btn btn-outline" data-testid="native-alert" onclick="alert('This is a native alert!')">
              Native Alert
            </button>
            <button class="btn btn-outline" data-testid="native-confirm" onclick="handleNativeConfirm()">
              Native Confirm
            </button>
            <button class="btn btn-outline" data-testid="native-prompt" onclick="handleNativePrompt()">
              Native Prompt
            </button>
          </div>

          <h3 style="margin: 2rem 0 1rem;">Tooltips</h3>
          <div class="popup-triggers">
            <button class="btn btn-outline tooltip" data-tooltip="This is a tooltip!" data-testid="tooltip-1">
              Hover me (Top)
            </button>
            <button class="btn btn-outline tooltip" data-tooltip="Another tooltip here" data-testid="tooltip-2">
              Hover me too
            </button>
          </div>
        </div>
      </div>

      <!-- Data Tables Section -->
      <div id="section-data" class="section-wrapper" style="display: none;" data-testid="section-data">
        <div class="section">
          <h2 class="section-title">Data Tables</h2>

          <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
            <input type="text" class="form-input" style="max-width: 300px;" placeholder="Search..." data-testid="table-search" oninput="filterTable(this.value)">
            <button class="btn btn-primary" data-testid="add-row" onclick="addTableRow()">+ Add Row</button>
          </div>

          <div style="overflow-x: auto;">
            <table class="data-table" data-testid="data-table">
              <thead>
                <tr>
                  <th onclick="sortTable(0)" data-testid="th-id">ID ‚Üï</th>
                  <th onclick="sortTable(1)" data-testid="th-name">Name ‚Üï</th>
                  <th onclick="sortTable(2)" data-testid="th-email">Email ‚Üï</th>
                  <th onclick="sortTable(3)" data-testid="th-status">Status ‚Üï</th>
                  <th data-testid="th-actions">Actions</th>
                </tr>
              </thead>
              <tbody id="tableBody" data-testid="table-body">
                <tr data-testid="row-1">
                  <td>1</td>
                  <td>John Doe</td>
                  <td>john@example.com</td>
                  <td><span class="status-badge status-active">Active</span></td>
                  <td class="table-actions">
                    <button class="btn btn-outline action-btn" data-testid="edit-1" onclick="editRow(1)">Edit</button>
                    <button class="btn btn-danger action-btn" data-testid="delete-1" onclick="deleteRow(1)">Delete</button>
                  </td>
                </tr>
                <tr data-testid="row-2">
                  <td>2</td>
                  <td>Jane Smith</td>
                  <td>jane@example.com</td>
                  <td><span class="status-badge status-pending">Pending</span></td>
                  <td class="table-actions">
                    <button class="btn btn-outline action-btn" data-testid="edit-2" onclick="editRow(2)">Edit</button>
                    <button class="btn btn-danger action-btn" data-testid="delete-2" onclick="deleteRow(2)">Delete</button>
                  </td>
                </tr>
                <tr data-testid="row-3">
                  <td>3</td>
                  <td>Bob Wilson</td>
                  <td>bob@example.com</td>
                  <td><span class="status-badge status-inactive">Inactive</span></td>
                  <td class="table-actions">
                    <button class="btn btn-outline action-btn" data-testid="edit-3" onclick="editRow(3)">Edit</button>
                    <button class="btn btn-danger action-btn" data-testid="delete-3" onclick="deleteRow(3)">Delete</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Pagination -->
          <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 1rem;">
            <span data-testid="pagination-info">Showing 1-3 of 3 entries</span>
            <div style="display: flex; gap: 0.25rem;">
              <button class="btn btn-outline" data-testid="page-prev" disabled>Previous</button>
              <button class="btn btn-primary" data-testid="page-1">1</button>
              <button class="btn btn-outline" data-testid="page-2">2</button>
              <button class="btn btn-outline" data-testid="page-3">3</button>
              <button class="btn btn-outline" data-testid="page-next">Next</button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Modals -->
  <div id="modal-basic" class="modal-overlay" data-testid="modal-basic">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Basic Modal</h3>
        <button class="modal-close" onclick="closeModal('basic')" data-testid="modal-close-basic">&times;</button>
      </div>
      <div class="modal-body">
        <p>This is a basic modal dialog with some content.</p>
        <p style="margin-top: 1rem;">Modals are commonly used for:</p>
        <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
          <li>Displaying additional information</li>
          <li>Confirming user actions</li>
          <li>Collecting user input</li>
        </ul>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="closeModal('basic')" data-testid="modal-cancel-basic">Cancel</button>
        <button class="btn btn-primary" onclick="closeModal('basic')" data-testid="modal-ok-basic">OK</button>
      </div>
    </div>
  </div>

  <div id="modal-form" class="modal-overlay" data-testid="modal-form">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Form Modal</h3>
        <button class="modal-close" onclick="closeModal('form')" data-testid="modal-close-form">&times;</button>
      </div>
      <div class="modal-body">
        <form id="modalForm" onsubmit="handleModalFormSubmit(event)">
          <div class="form-group">
            <label class="form-label">Name</label>
            <input type="text" class="form-input" name="modalName" data-testid="modal-input-name" required>
          </div>
          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-input" name="modalEmail" data-testid="modal-input-email" required>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="closeModal('form')" data-testid="modal-cancel-form">Cancel</button>
        <button class="btn btn-primary" onclick="document.getElementById('modalForm').dispatchEvent(new Event('submit'))" data-testid="modal-submit-form">Submit</button>
      </div>
    </div>
  </div>

  <div id="modal-confirm" class="modal-overlay" data-testid="modal-confirm">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Confirm Action</h3>
        <button class="modal-close" onclick="closeModal('confirm')" data-testid="modal-close-confirm">&times;</button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to proceed with this action?</p>
        <p style="color: var(--error); margin-top: 0.5rem;">This action cannot be undone.</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="closeModal('confirm')" data-testid="modal-cancel-confirm">Cancel</button>
        <button class="btn btn-danger" onclick="handleConfirm()" data-testid="modal-confirm-confirm">Confirm</button>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer" data-testid="toast-container"></div>

  <script>
    // ==================== Navigation ====================
    function showSection(sectionId) {
      document.querySelectorAll('.section-wrapper').forEach(el => el.style.display = 'none');
      document.querySelectorAll('.sidebar-item').forEach(el => el.classList.remove('active'));

      document.getElementById('section-' + sectionId).style.display = 'block';
      event.target.classList.add('active');
    }

    function toggleDropdown(dropdown) {
      dropdown.classList.toggle('open');
    }

    // Close dropdowns when clicking outside
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.dropdown')) {
        document.querySelectorAll('.dropdown').forEach(d => d.classList.remove('open'));
      }
    });

    // ==================== Tabs ====================
    function showTab(tabId) {
      document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));

      document.getElementById('tab-' + tabId).classList.add('active');
      event.target.classList.add('active');
    }

    // ==================== Accordion ====================
    function toggleAccordion(item) {
      item.classList.toggle('open');
    }

    // ==================== Forms ====================
    function handleContactSubmit(e) {
      e.preventDefault();
      const formData = new FormData(e.target);
      console.log('Contact form submitted:', Object.fromEntries(formData));
      showToast('success', 'Message sent successfully!');
      e.target.reset();
    }

    function handleRegistrationSubmit(e) {
      e.preventDefault();
      const formData = new FormData(e.target);
      const data = Object.fromEntries(formData);

      if (data.password !== data.confirmPassword) {
        showToast('error', 'Passwords do not match!');
        return;
      }

      console.log('Registration form submitted:', data);
      showToast('success', 'Account created successfully!');
      e.target.reset();
    }

    function handleFeedbackSubmit(e) {
      e.preventDefault();
      const formData = new FormData(e.target);
      console.log('Feedback form submitted:', Object.fromEntries(formData));
      showToast('success', 'Thank you for your feedback!');
      e.target.reset();
    }

    let currentRating = 0;
    function setRating(rating) {
      currentRating = rating;
      document.getElementById('ratingValue').value = rating;

      const buttons = document.querySelectorAll('[data-testid^="star-"]');
      buttons.forEach((btn, idx) => {
        btn.style.background = idx < rating ? 'var(--accent)' : '';
        btn.style.color = idx < rating ? 'white' : '';
      });
    }

    function handleFileSelect(input) {
      const file = input.files[0];
      const preview = document.getElementById('filePreview');

      if (file) {
        preview.innerHTML = `
          <div style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; background: var(--bg); border-radius: 4px;">
            <span>üìé</span>
            <span>${file.name}</span>
            <span style="color: #666;">(${(file.size / 1024).toFixed(1)} KB)</span>
            <button type="button" class="btn btn-outline" style="margin-left: auto; padding: 0.25rem 0.5rem;" onclick="clearFile()">Remove</button>
          </div>
        `;
      }
    }

    function clearFile() {
      document.getElementById('fileInput').value = '';
      document.getElementById('filePreview').innerHTML = '';
    }

    // Drag and drop
    const fileUpload = document.querySelector('.file-upload');
    if (fileUpload) {
      fileUpload.addEventListener('dragover', (e) => {
        e.preventDefault();
        fileUpload.classList.add('dragover');
      });

      fileUpload.addEventListener('dragleave', () => {
        fileUpload.classList.remove('dragover');
      });

      fileUpload.addEventListener('drop', (e) => {
        e.preventDefault();
        fileUpload.classList.remove('dragover');
        const file = e.dataTransfer.files[0];
        if (file) {
          document.getElementById('fileInput').files = e.dataTransfer.files;
          handleFileSelect(document.getElementById('fileInput'));
        }
      });
    }

    // ==================== IFrame ====================
    function loadIframeContent(type) {
      const iframe = document.getElementById('iframe1');
      let content = '';

      switch (type) {
        case 'form':
          content = `
            <html>
            <body style="padding: 20px; font-family: sans-serif;">
              <h3>Embedded Form</h3>
              <form onsubmit="event.preventDefault(); parent.postMessage({type: 'formSubmit', data: 'Form submitted!'}, '*');">
                <input type="text" placeholder="Enter name" data-testid="iframe-input" style="padding: 8px; margin-bottom: 10px; width: 100%;">
                <button type="submit" data-testid="iframe-submit" style="padding: 8px 16px; background: #2563eb; color: white; border: none; cursor: pointer;">Submit</button>
              </form>
            </body>
            </html>
          `;
          break;
        case 'chart':
          content = `
            <html>
            <body style="padding: 20px; font-family: sans-serif;">
              <h3>Embedded Chart</h3>
              <canvas id="miniChart" width="400" height="200"></canvas>
              <script>
                const ctx = document.getElementById('miniChart').getContext('2d');
                const data = [30, 50, 40, 60, 45, 70];
                const barWidth = 50;
                const gap = 15;
                data.forEach((val, i) => {
                  ctx.fillStyle = '#' + Math.floor(Math.random()*16777215).toString(16);
                  ctx.fillRect(i * (barWidth + gap), 200 - val * 2, barWidth, val * 2);
                });
              <\/script>
            </body>
            </html>
          `;
          break;
        case 'list':
          content = `
            <html>
            <body style="padding: 20px; font-family: sans-serif;">
              <h3>Embedded List</h3>
              <ul id="itemList" style="list-style: none; padding: 0;">
                <li style="padding: 10px; border-bottom: 1px solid #eee;">Item 1 <button onclick="parent.postMessage({type: 'itemClick', id: 1}, '*')">Select</button></li>
                <li style="padding: 10px; border-bottom: 1px solid #eee;">Item 2 <button onclick="parent.postMessage({type: 'itemClick', id: 2}, '*')">Select</button></li>
                <li style="padding: 10px; border-bottom: 1px solid #eee;">Item 3 <button onclick="parent.postMessage({type: 'itemClick', id: 3}, '*')">Select</button></li>
              </ul>
            </body>
            </html>
          `;
          break;
      }

      iframe.srcdoc = content;
      document.querySelector('[data-testid="iframe-url-1"]').value = `data:text/html (${type} content)`;
    }

    function refreshIframe(id) {
      const iframe = document.getElementById(id);
      iframe.src = iframe.src;
    }

    // Listen for messages from iframes
    window.addEventListener('message', (e) => {
      console.log('Message from iframe:', e.data);
      if (e.data.type === 'formSubmit') {
        showToast('success', e.data.data);
      } else if (e.data.type === 'itemClick') {
        showToast('info', 'Selected item ' + e.data.id);
      }
    });

    // ==================== Canvas Drawing ====================
    const drawingCanvas = document.getElementById('drawingCanvas');
    const drawingCtx = drawingCanvas ? drawingCanvas.getContext('2d') : null;
    let isDrawing = false;
    let lastX = 0;
    let lastY = 0;
    let canvasHistory = [];

    if (drawingCanvas) {
      // Save initial state
      saveCanvasState();

      drawingCanvas.addEventListener('mousedown', (e) => {
        isDrawing = true;
        [lastX, lastY] = [e.offsetX, e.offsetY];
      });

      drawingCanvas.addEventListener('mousemove', (e) => {
        if (!isDrawing) return;

        const color = document.getElementById('brushColor').value;
        const size = document.getElementById('brushSize').value;
        const type = document.getElementById('brushType').value;

        drawingCtx.strokeStyle = color;
        drawingCtx.lineWidth = size;
        drawingCtx.lineCap = type;
        drawingCtx.lineJoin = type;

        drawingCtx.beginPath();
        drawingCtx.moveTo(lastX, lastY);
        drawingCtx.lineTo(e.offsetX, e.offsetY);
        drawingCtx.stroke();

        [lastX, lastY] = [e.offsetX, e.offsetY];
      });

      drawingCanvas.addEventListener('mouseup', () => {
        if (isDrawing) {
          isDrawing = false;
          saveCanvasState();
        }
      });

      drawingCanvas.addEventListener('mouseout', () => {
        if (isDrawing) {
          isDrawing = false;
          saveCanvasState();
        }
      });
    }

    function saveCanvasState() {
      if (drawingCanvas) {
        canvasHistory.push(drawingCanvas.toDataURL());
        if (canvasHistory.length > 50) canvasHistory.shift();
      }
    }

    function undoCanvas() {
      if (canvasHistory.length > 1) {
        canvasHistory.pop();
        const img = new Image();
        img.onload = () => {
          drawingCtx.clearRect(0, 0, drawingCanvas.width, drawingCanvas.height);
          drawingCtx.drawImage(img, 0, 0);
        };
        img.src = canvasHistory[canvasHistory.length - 1];
      }
    }

    function clearCanvas() {
      if (drawingCtx) {
        drawingCtx.clearRect(0, 0, drawingCanvas.width, drawingCanvas.height);
        canvasHistory = [];
        saveCanvasState();
      }
    }

    function saveCanvas() {
      if (drawingCanvas) {
        const link = document.createElement('a');
        link.download = 'drawing.png';
        link.href = drawingCanvas.toDataURL();
        link.click();
        showToast('success', 'Drawing saved!');
      }
    }

    // Chart Canvas
    function drawChart(type) {
      const chartCanvas = document.getElementById('chartCanvas');
      if (!chartCanvas) return;

      const ctx = chartCanvas.getContext('2d');
      ctx.clearRect(0, 0, chartCanvas.width, chartCanvas.height);

      const data = [65, 45, 80, 35, 90, 55, 70];
      const labels = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
      const colors = ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe', '#00f2fe', '#43e97b'];

      switch (type) {
        case 'bar':
          const barWidth = 60;
          const gap = 40;
          const startX = 80;
          const maxHeight = 220;

          data.forEach((val, i) => {
            const height = (val / 100) * maxHeight;
            const x = startX + i * (barWidth + gap);
            const y = 250 - height;

            ctx.fillStyle = colors[i];
            ctx.fillRect(x, y, barWidth, height);

            ctx.fillStyle = '#333';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(labels[i], x + barWidth / 2, 270);
            ctx.fillText(val, x + barWidth / 2, y - 5);
          });
          break;

        case 'line':
          ctx.beginPath();
          ctx.strokeStyle = '#2563eb';
          ctx.lineWidth = 3;

          data.forEach((val, i) => {
            const x = 80 + i * 100;
            const y = 250 - (val / 100) * 220;

            if (i === 0) {
              ctx.moveTo(x, y);
            } else {
              ctx.lineTo(x, y);
            }

            ctx.fillStyle = '#333';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(labels[i], x, 270);
          });
          ctx.stroke();

          // Draw points
          data.forEach((val, i) => {
            const x = 80 + i * 100;
            const y = 250 - (val / 100) * 220;
            ctx.beginPath();
            ctx.arc(x, y, 6, 0, Math.PI * 2);
            ctx.fillStyle = '#2563eb';
            ctx.fill();
          });
          break;

        case 'pie':
          const centerX = 400;
          const centerY = 150;
          const radius = 100;
          let startAngle = 0;
          const total = data.reduce((a, b) => a + b, 0);

          data.forEach((val, i) => {
            const sliceAngle = (val / total) * 2 * Math.PI;
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.arc(centerX, centerY, radius, startAngle, startAngle + sliceAngle);
            ctx.closePath();
            ctx.fillStyle = colors[i];
            ctx.fill();
            startAngle += sliceAngle;
          });

          // Legend
          data.forEach((val, i) => {
            ctx.fillStyle = colors[i];
            ctx.fillRect(550, 30 + i * 25, 15, 15);
            ctx.fillStyle = '#333';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText(`${labels[i]}: ${val}`, 575, 42 + i * 25);
          });
          break;
      }
    }

    // ==================== Shadow DOM ====================
    function initShadowDOM() {
      // Card Component
      const cardContainer = document.getElementById('shadow-card-container');
      if (cardContainer) {
        const card = document.createElement('div');
        const shadow = card.attachShadow({ mode: 'open' });
        shadow.innerHTML = `
          <style>
            .card {
              background: white;
              border-radius: 12px;
              box-shadow: 0 4px 15px rgba(0,0,0,0.1);
              padding: 1.5rem;
              max-width: 400px;
            }
            .card-header { font-size: 1.25rem; font-weight: bold; margin-bottom: 1rem; }
            .card-body { color: #666; line-height: 1.6; }
            .card-footer { margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #eee; }
            .btn {
              padding: 0.5rem 1rem;
              background: #2563eb;
              color: white;
              border: none;
              border-radius: 4px;
              cursor: pointer;
            }
          </style>
          <div class="card" data-testid="shadow-card">
            <div class="card-header">Shadow DOM Card</div>
            <div class="card-body">
              This card is rendered inside Shadow DOM. Its styles are encapsulated and won't affect or be affected by the main document styles.
            </div>
            <div class="card-footer">
              <button class="btn" data-testid="shadow-card-btn">Click Me</button>
            </div>
          </div>
        `;

        shadow.querySelector('button').addEventListener('click', () => {
          showToast('info', 'Button inside Shadow DOM clicked!');
        });

        cardContainer.appendChild(card);
      }

      // Button Component
      const buttonContainer = document.getElementById('shadow-button-container');
      if (buttonContainer) {
        const buttonWrapper = document.createElement('div');
        const buttonShadow = buttonWrapper.attachShadow({ mode: 'open' });
        buttonShadow.innerHTML = `
          <style>
            :host { display: inline-block; }
            .custom-btn {
              padding: 12px 24px;
              font-size: 1rem;
              font-weight: 600;
              border: none;
              border-radius: 8px;
              cursor: pointer;
              transition: all 0.2s;
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              color: white;
              box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            }
            .custom-btn:hover {
              transform: translateY(-2px);
              box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
            }
            .custom-btn:active {
              transform: translateY(0);
            }
          </style>
          <button class="custom-btn" data-testid="shadow-custom-btn">Custom Shadow Button</button>
        `;

        buttonShadow.querySelector('button').addEventListener('click', () => {
          showToast('success', 'Custom shadow button clicked!');
        });

        buttonContainer.appendChild(buttonWrapper);
      }

      // Input Component
      const inputContainer = document.getElementById('shadow-input-container');
      if (inputContainer) {
        const inputWrapper = document.createElement('div');
        const inputShadow = inputWrapper.attachShadow({ mode: 'open' });
        inputShadow.innerHTML = `
          <style>
            :host { display: block; max-width: 400px; }
            .input-wrapper {
              position: relative;
            }
            .custom-input {
              width: 100%;
              padding: 12px 16px;
              font-size: 1rem;
              border: 2px solid #e2e8f0;
              border-radius: 8px;
              transition: all 0.2s;
              box-sizing: border-box;
            }
            .custom-input:focus {
              outline: none;
              border-color: #2563eb;
              box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
            }
            .input-label {
              position: absolute;
              left: 12px;
              top: 50%;
              transform: translateY(-50%);
              color: #94a3b8;
              transition: all 0.2s;
              pointer-events: none;
              background: white;
              padding: 0 4px;
            }
            .custom-input:focus + .input-label,
            .custom-input:not(:placeholder-shown) + .input-label {
              top: 0;
              font-size: 0.75rem;
              color: #2563eb;
            }
          </style>
          <div class="input-wrapper">
            <input type="text" class="custom-input" placeholder=" " data-testid="shadow-input">
            <label class="input-label">Enter your text</label>
          </div>
        `;

        inputContainer.appendChild(inputWrapper);
      }

      // Toggle Component
      const toggleContainer = document.getElementById('shadow-toggle-container');
      if (toggleContainer) {
        const toggleWrapper = document.createElement('div');
        const toggleShadow = toggleWrapper.attachShadow({ mode: 'open' });
        toggleShadow.innerHTML = `
          <style>
            :host { display: inline-flex; align-items: center; gap: 12px; }
            .toggle {
              position: relative;
              width: 50px;
              height: 26px;
              background: #e2e8f0;
              border-radius: 13px;
              cursor: pointer;
              transition: background 0.2s;
            }
            .toggle.active {
              background: #22c55e;
            }
            .toggle-knob {
              position: absolute;
              top: 3px;
              left: 3px;
              width: 20px;
              height: 20px;
              background: white;
              border-radius: 50%;
              box-shadow: 0 2px 4px rgba(0,0,0,0.2);
              transition: transform 0.2s;
            }
            .toggle.active .toggle-knob {
              transform: translateX(24px);
            }
            .toggle-label {
              font-weight: 500;
              color: #333;
            }
          </style>
          <div class="toggle" data-testid="shadow-toggle">
            <div class="toggle-knob"></div>
          </div>
          <span class="toggle-label">Enable Feature</span>
        `;

        const toggle = toggleShadow.querySelector('.toggle');
        toggle.addEventListener('click', () => {
          toggle.classList.toggle('active');
          showToast('info', `Feature ${toggle.classList.contains('active') ? 'enabled' : 'disabled'}`);
        });

        toggleContainer.appendChild(toggleWrapper);
      }
    }

    // ==================== Modals & Popups ====================
    function openModal(type) {
      document.getElementById('modal-' + type).classList.add('open');
    }

    function closeModal(type) {
      document.getElementById('modal-' + type).classList.remove('open');
    }

    function handleModalFormSubmit(e) {
      e.preventDefault();
      const formData = new FormData(e.target);
      console.log('Modal form submitted:', Object.fromEntries(formData));
      closeModal('form');
      showToast('success', 'Form submitted from modal!');
      e.target.reset();
    }

    function handleConfirm() {
      closeModal('confirm');
      showToast('success', 'Action confirmed!');
    }

    function openPopupWindow() {
      const popup = window.open('', 'popup', 'width=400,height=300,left=200,top=200');
      popup.document.write(`
        <html>
        <head><title>Popup Window</title></head>
        <body style="padding: 20px; font-family: sans-serif;">
          <h2>Popup Window</h2>
          <p>This is a popup window opened from the main page.</p>
          <button onclick="window.opener.postMessage('Hello from popup!', '*'); window.close();" data-testid="popup-close">
            Send Message & Close
          </button>
        </body>
        </html>
      `);
    }

    function handleNativeConfirm() {
      const result = confirm('Are you sure you want to continue?');
      showToast('info', result ? 'Confirmed!' : 'Cancelled!');
    }

    function handleNativePrompt() {
      const name = prompt('What is your name?');
      if (name) {
        showToast('success', 'Hello, ' + name + '!');
      }
    }

    // ==================== Toast ====================
    function showToast(type, message) {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = 'toast ' + type;
      toast.innerHTML = `
        <span>${type === 'success' ? '‚úì' : type === 'error' ? '‚úó' : '‚Ñπ'}</span>
        <span>${message}</span>
        <button onclick="this.parentElement.remove()" style="background:none;border:none;cursor:pointer;margin-left:auto;">‚úï</button>
      `;
      container.appendChild(toast);

      setTimeout(() => {
        if (toast.parentElement) toast.remove();
      }, 3000);
    }

    // ==================== Data Table ====================
    let tableData = [
      { id: 1, name: 'John Doe', email: 'john@example.com', status: 'active' },
      { id: 2, name: 'Jane Smith', email: 'jane@example.com', status: 'pending' },
      { id: 3, name: 'Bob Wilson', email: 'bob@example.com', status: 'inactive' },
    ];

    function filterTable(query) {
      const rows = document.querySelectorAll('#tableBody tr');
      const lowerQuery = query.toLowerCase();

      rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(lowerQuery) ? '' : 'none';
      });
    }

    let sortDirection = {};
    function sortTable(column) {
      const tbody = document.getElementById('tableBody');
      const rows = Array.from(tbody.querySelectorAll('tr'));

      sortDirection[column] = !sortDirection[column];
      const direction = sortDirection[column] ? 1 : -1;

      rows.sort((a, b) => {
        const aVal = a.cells[column].textContent;
        const bVal = b.cells[column].textContent;
        return aVal.localeCompare(bVal) * direction;
      });

      rows.forEach(row => tbody.appendChild(row));
    }

    function addTableRow() {
      const newId = tableData.length + 1;
      const name = prompt('Enter name:');
      if (!name) return;

      const email = prompt('Enter email:');
      if (!email) return;

      tableData.push({ id: newId, name, email, status: 'pending' });
      renderTable();
      showToast('success', 'Row added successfully!');
    }

    function editRow(id) {
      const item = tableData.find(d => d.id === id);
      if (!item) return;

      const newName = prompt('Edit name:', item.name);
      if (newName) item.name = newName;

      renderTable();
      showToast('success', 'Row updated!');
    }

    function deleteRow(id) {
      if (!confirm('Are you sure you want to delete this row?')) return;

      tableData = tableData.filter(d => d.id !== id);
      renderTable();
      showToast('success', 'Row deleted!');
    }

    function renderTable() {
      const tbody = document.getElementById('tableBody');
      tbody.innerHTML = tableData.map(item => `
        <tr data-testid="row-${item.id}">
          <td>${item.id}</td>
          <td>${item.name}</td>
          <td>${item.email}</td>
          <td><span class="status-badge status-${item.status}">${item.status.charAt(0).toUpperCase() + item.status.slice(1)}</span></td>
          <td class="table-actions">
            <button class="btn btn-outline action-btn" data-testid="edit-${item.id}" onclick="editRow(${item.id})">Edit</button>
            <button class="btn btn-danger action-btn" data-testid="delete-${item.id}" onclick="deleteRow(${item.id})">Delete</button>
          </td>
        </tr>
      `).join('');
    }

    // ==================== Initialize ====================
    document.addEventListener('DOMContentLoaded', () => {
      initShadowDOM();
      drawChart('bar');
    });
  </script>
</body>
</html>
